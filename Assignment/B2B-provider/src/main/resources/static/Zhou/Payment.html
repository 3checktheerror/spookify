<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Payment</title>
    <!-- 引入 Vue.js 和 Axios -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
<div id="app">
    <h1>支付</h1>
    <div v-if="selectedOrders.length === 0">请选择订单</div>
    <div v-else>
        <div v-for="(order, index) in selectedOrders" :key="index">
            <h2>订单号: {{ order }}</h2>
            <!-- 从接口获取支付相关信息，展示在页面上 -->
            <p>支付方式: {{ paymentInfo.paymentMethod }}</p>
            <p>应付金额: {{ paymentInfo.amount }}</p>
            <!-- 其他支付信息... -->
            <hr>
        </div>
        <button @click="pay">支付</button>
    </div>
</div>

<script>
    new Vue({
        el: '#app',
        data() {
            return {
                selectedOrders: [], // 存放用户勾选的订单号
                paymentInfo: {} // 存放支付相关信息的对象
            };
        },
        mounted() {
            // 在页面加载完成后调用接口获取支付信息
            this.getPaymentInfo();
        },
        methods: {
            getPaymentInfo() {
                // 获取 URL 中的勾选订单号参数
                const params = new URLSearchParams(window.location.search);
                this.selectedOrders = params.get('selectedOrders').split(',');

                // 使用 Axios 调用支付接口，传递用户勾选的订单号
                axios.post('http://localhost:8082/payment/getPaymentInfo', { selectedOrders: this.selectedOrders })
                    .then(response => {
                        // 将接口返回的支付信息存入 paymentInfo 对象
                        this.paymentInfo = response.data;
                    })
                    .catch(error => {
                        console.error('获取支付信息失败:', error);
                    });
            },
            pay() {
                // 调用支付接口进行支付操作
                axios.post('http://localhost:8082/payment/pay', { selectedOrders: this.selectedOrders })
                    .then(response => {
                        // 弹出支付成功提示
                        alert('支付成功');
                        // 跳转回购物车页面
                        window.location.href = 'shopping_cart.html';
                    })
                    .catch(error => {
                        console.error('支付失败:', error);
                    });
            }
        }
    });
</script>
</body>
</html>
