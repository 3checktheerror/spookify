<html>
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <title>hello</title>
</head>
<body>
<div id="app">
        <h2>Samle</h2>
<!--    展示所有取得的数据-->
        <p>{{responseData}}</p>
    <!--    取出具体数据-->
        <p>{{responseData[0].pId}}</p>

<!--    展示数据表-->
    <el-main>
    <el-table class="table" :data="responseData">
        <el-table-column prop="pId" label="ID" width="250" sortable></el-table-column>
        <el-table-column prop="pName" label="Name" width="250"
                         sortable></el-table-column>
        <el-table-column prop="pdModified" label="Last Modified" width="380" sortable>
            <template slot-scope="{ row }">
                {{ formatDate(row.pdModified) }}
            </template>
        </el-table-column>
    </el-table>

<!--    发数据表-->
    <el-form :model="formData" ref="form" :rules="formRules" label-width="100px">
        <el-col :span="15">
            <el-form-item label="Name" prop="name">
                <el-input v-model="formData.name"></el-input>
            </el-form-item>
            <el-form-item label="Price" prop="price">
                <el-input v-model="formData.price"> </el-input>
            </el-form-item>
            <el-form-item label="Quantity" prop="quantity">
                <el-input v-model.number="formData.quantity"></el-input>
            </el-form-item>
            <el-form-item label="Category" prop="category">
                <el-input v-model="formData.category"></el-input>
            </el-form-item>
            <el-form-item label="Size" prop="size">
                <el-input v-model="formData.size"></el-input>
            </el-form-item>
            <el-form-item label="Style" prop="style">
                <el-input v-model="formData.style"></el-input>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" @click="validateAndSubmit()">Submit</el-button>
            </el-form-item>
        </el-col >
    </el-form>
    <el-dialog
            title="Create Successful"
            :visible.sync="successDialogVisible"
            width="50%"
    >
        <p v-if="responseData">Successfully submitted</p>
        <div slot="footer" class="dialog-footer">
            <el-button type="primary" @click="closeSuccessDialog">OK</el-button>
        </div>
    </el-dialog>
    </el-main>

</div>

<script>
    new Vue( {
        el: '#app',
        data() {
            return {
                //传的数据
                formData: {
                    name: '',
                    price:'',
                    quantity: '',
                    category: '',
                    size: '',
                    style: ''
                },
                successDialogVisible: false, // 控制弹窗显示/隐藏
                beforeUploadCancelled: true, // 添加标志，记录是否因为 before-upload 取消上传
                //取的数据
                responseData: null, // 存储后端响应数据
                ID: null,
                // 校验
                formRules: {
                    name: [
                        { required: true, message: 'Please enter your name', trigger: 'blur' },
                        // Add other validation rules as needed
                    ]
                },
            };
        },
        mounted() {
            this.getData();
        },
        methods: {
            getData() {
                axios.get('/product/getAllProducts')
                    .then(response => {
                        console.log('Response from backend:', response.data);
                        this.responseData = response.data.data;
                    })
                    .catch(error => {
                        console.error(error);
                    });
            },
            validateAndSubmit() {
                this.$refs.form.validate((valid) => {
                    if (valid) {
                        // 所有表单项验证通过，执行提交逻辑
                        this.submitForm();
                    } else {
                        // 有表单项验证失败，不执行提交逻辑
                        console.log('Form validation failed');
                    }
                });
            },
            submitForm() {
                // 构建要提交的数据
                const postData = {
                    pName: this.formData.name,
                    price: this.formData.price,
                    quantityInStock: this.formData.quantity,
                    category: this.formData.category,
                    map: {
                        "size": this.formData.size,
                        "Style": this.formData.style
                    },
                    md5: null,
                    token: null,
                    sessionId: null,
                    manufacturer: "",
                    description: ""

                };
                console.log(postData);


                // 使用 Axios 发送 POST 请求到后端
                axios.post('/product/insertProduct', postData,)
                    .then(response => {
                        // 请求成功的处理逻辑
                        console.log('Response from backend:', response.data);
                        this.showSuccessDialog();
                    })
                    .catch(error => {
                        // 请求失败的处理逻辑
                        console.error('请求失败:', error);
                    });
            },

            showSuccessDialog() {
                this.successDialogVisible = true;
            },
            closeSuccessDialog() {
                this.successDialogVisible = false;
            },
            formatDate(dateString) {
                return moment(dateString).format('YYYY-MM-DD HH:mm:ss');
            },
        }
    });
</script>

</body>
</html>
